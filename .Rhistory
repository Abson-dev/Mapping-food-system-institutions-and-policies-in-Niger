"q_iii_24_4",
"q_iii_24_5",
"q_iii_24_96"
)
label_vec = c("Annual",
"Half-yearly",
"Quarterly",
"Bimonthly",
"Monthly",
"Other ( specify)"
)
df = EVALUATION_DES_CAPACITES_Hema  %>% dplyr::select(domain,var_vec) %>%
dplyr::mutate(dom_1=ifelse(dom_1==1,"Yes","No")) %>%
dplyr::mutate(dom_2=ifelse(dom_2==1,"Yes","No")) %>%
dplyr::mutate(dom_3=ifelse(dom_3==1,"Yes","No")) %>%
dplyr::mutate(dom_4=ifelse(dom_4==1,"Yes","No")) %>%
dplyr::mutate(dom_5=ifelse(dom_5==1,"Yes","No")) %>%
dplyr::mutate(across(var_vec, as.numeric))%>%
dplyr::mutate_at(var_vec, ~ sjlabelled::set_label(.x,label = label_vec))
tb_1 = df %>% dplyr::select(dom_1,var_vec
) %>%
tbl_summary(by = dom_1,
type= (list=var_vec ~ "continuous"),
statistic = list(all_continuous() ~ "{mean}"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Nutrition, health, and food, security") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
## domain 2
tb_2=df %>% dplyr::select(dom_2,var_vec
) %>%
tbl_summary(by = dom_2,
type= (list=var_vec ~ "continuous"),
statistic = list(all_continuous() ~ "{mean}"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Poverty reduction, livelihoods, and jobs") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
tb_3=df %>% dplyr::select(dom_3,var_vec
)  %>%
tbl_summary(by = dom_3,
type= (list=var_vec ~ "continuous"),
statistic = list(all_continuous() ~ "{mean}"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Gender equality, youth, and social inclusion") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
tb_4=df %>% dplyr::select(dom_4,var_vec
)%>%
tbl_summary(by = dom_4,
type= (list=var_vec ~ "continuous"),
statistic = list(all_continuous() ~ "{mean}"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Climate adaptation and mitigation") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
tb_5=df %>% dplyr::select(dom_5,var_vec
) %>%
tbl_summary(by = dom_5,
type= (list=var_vec ~ "continuous"),
statistic = list(all_continuous() ~ "{mean}"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Environmental health and biodiversity") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
df_1=tb_1$table_body[,c("var_label","stat_0","stat_2")]
df_2=tb_2$table_body[,c("stat_2")]
df_3=tb_3$table_body[,c("stat_2")]
df_4=tb_4$table_body[,c("stat_2")]
df_5=tb_5$table_body[,c("stat_2")]
df_fc = cbind(df_1,
df_2,
df_3,
df_4,
df_5)
names(df_fc)=c("Inspection frequency",
"All",
"Nutrition, health, and food, security",
"Poverty reduction, livelihoods, and jobs",
"Gender equality, youth, and social inclusion",
"Climate adaptation and mitigation",
"Environmental health and biodiversity"
)
# hs <- createStyle(
#   textDecoration = "BOLD", fontColour = "#FFFFFF", fontSize = 12,
#   fontName = "Arial Narrow", fgFill = "#4F80BD"
# )
#
# write.xlsx(df_fc,
#            file = "Tables Ability to evaluate.xlsx",
#            colNames = TRUE, borders = "rows", headerStyle = hs, sheetName = "Ability to evaluate", append=TRUE
# )
# Create flextable object
ft <- flextable(data = df_fc)
# See flextable in RStudio viewer
ft
var_vec = c("q_iii_25"
)
label_vec = c("Totally agree",
"Agree",
"Neutral",
"Disagree",
"Strongly Disagree"
)
df = EVALUATION_DES_CAPACITES_Hema  %>% dplyr::select(domain,var_vec) %>%
dplyr::mutate(dom_1=ifelse(dom_1==1,"Yes","No")) %>%
dplyr::mutate(dom_2=ifelse(dom_2==1,"Yes","No")) %>%
dplyr::mutate(dom_3=ifelse(dom_3==1,"Yes","No")) %>%
dplyr::mutate(dom_4=ifelse(dom_4==1,"Yes","No")) %>%
dplyr::mutate(dom_5=ifelse(dom_5==1,"Yes","No"))  %>%
labelled::to_factor()
#   dplyr::mutate_at(var_vec, ~ sjlabelled::set_label(.x,label = label_vec))
tb_1 = df %>% dplyr::select(dom_1,var_vec
) %>%
tbl_summary(by = dom_1,
type= (list=var_vec ~ "categorical"),
statistic = list(all_categorical() ~ "{p}({n})"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Nutrition, health, and food, security") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
## domain 2
tb_2=df %>% dplyr::select(dom_2,var_vec
) %>%
tbl_summary(by = dom_2,
type= (list=var_vec ~ "categorical"),
statistic = list(all_categorical() ~ "{p}({n})"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Poverty reduction, livelihoods, and jobs") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
tb_3=df %>% dplyr::select(dom_3,var_vec
)  %>%
tbl_summary(by = dom_3,
type= (list=var_vec ~ "categorical"),
statistic = list(all_categorical() ~ "{p}({n})"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Gender equality, youth, and social inclusion") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
tb_4=df %>% dplyr::select(dom_4,var_vec
)%>%
tbl_summary(by = dom_4,
type= (list=var_vec ~ "categorical"),
statistic = list(all_categorical() ~ "{p}({n})"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Climate adaptation and mitigation") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
tb_5=df %>% dplyr::select(dom_5,var_vec
) %>%
tbl_summary(by = dom_5,
type= (list=var_vec ~ "categorical"),
statistic = list(all_categorical() ~ "{p}({n})"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Environmental health and biodiversity") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
df_1=tb_1$table_body[,c("label","stat_0","stat_2")] %>% slice(-1)
df_2=tb_2$table_body[,c("stat_2")] %>% slice(-1)
df_3=tb_3$table_body[,c("stat_2")] %>% slice(-1)
df_4=tb_4$table_body[,c("stat_2")] %>% slice(-1)
df_5=tb_5$table_body[,c("stat_2")] %>% slice(-1)
df_fc = cbind(df_1,
df_2,
df_3,
df_4,
df_5)
names(df_fc)=c("Leadership is responsive, inspiring and sensitive",
"All",
"Nutrition, health, and food, security",
"Poverty reduction, livelihoods, and jobs",
"Gender equality, youth, and social inclusion",
"Climate adaptation and mitigation",
"Environmental health and biodiversity"
)
# hs <- createStyle(
#   textDecoration = "BOLD", fontColour = "#FFFFFF", fontSize = 12,
#   fontName = "Arial Narrow", fgFill = "#4F80BD"
# )
#
# write.xlsx(df_fc,
#            file = "Tables Ability to evaluate.xlsx",
#            colNames = TRUE, borders = "rows", headerStyle = hs, sheetName = "Ability to evaluate", append=TRUE
# )
# Create flextable object
ft <- flextable(data = df_fc)
# See flextable in RStudio viewer
ft
var_vec = c("q_iii_27_1",
"q_iii_27_2",
"q_iii_27_3",
"q_iii_27_4",
"q_iii_27_5",
"q_iii_27_6",
"q_iii_27_7",
"q_iii_27_8",
"q_iii_27_9",
"q_iii_27_10",
"q_iii_27_96"
)
label_vec = c("Commitment to food security",
"Recognition of the importance of family farming in national food production",
"Management of natural resources",
"Raising awareness of sustainable agricultural practices",
"International partnerships",
"Nutrition programs",
"Agricultural education programs",
"Adapting to climate change",
"Commitment to innovation ",
"Inclusivity and participation",
"Other ( specify )"
)
df = EVALUATION_DES_CAPACITES_Hema  %>% dplyr::select(domain,var_vec) %>%
dplyr::mutate(dom_1=ifelse(dom_1==1,"Yes","No")) %>%
dplyr::mutate(dom_2=ifelse(dom_2==1,"Yes","No")) %>%
dplyr::mutate(dom_3=ifelse(dom_3==1,"Yes","No")) %>%
dplyr::mutate(dom_4=ifelse(dom_4==1,"Yes","No")) %>%
dplyr::mutate(dom_5=ifelse(dom_5==1,"Yes","No")) %>%
dplyr::mutate(across(var_vec, as.numeric))%>%
dplyr::mutate_at(var_vec, ~ sjlabelled::set_label(.x,label = label_vec))
tb_1 = df %>% dplyr::select(dom_1,var_vec
) %>%
tbl_summary(by = dom_1,
type= (list=var_vec ~ "continuous"),
statistic = list(all_continuous() ~ "{mean}"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Nutrition, health, and food, security") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
## domain 2
tb_2=df %>% dplyr::select(dom_2,var_vec
) %>%
tbl_summary(by = dom_2,
type= (list=var_vec ~ "continuous"),
statistic = list(all_continuous() ~ "{mean}"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Poverty reduction, livelihoods, and jobs") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
tb_3=df %>% dplyr::select(dom_3,var_vec
)  %>%
tbl_summary(by = dom_3,
type= (list=var_vec ~ "continuous"),
statistic = list(all_continuous() ~ "{mean}"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Gender equality, youth, and social inclusion") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
tb_4=df %>% dplyr::select(dom_4,var_vec
)%>%
tbl_summary(by = dom_4,
type= (list=var_vec ~ "continuous"),
statistic = list(all_continuous() ~ "{mean}"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Climate adaptation and mitigation") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
tb_5=df %>% dplyr::select(dom_5,var_vec
) %>%
tbl_summary(by = dom_5,
type= (list=var_vec ~ "continuous"),
statistic = list(all_continuous() ~ "{mean}"),
digits = everything() ~ c(2,0), missing = "no") %>%
modify_header(label = "Environmental health and biodiversity") %>%
add_overall() %>%
add_n() %>%
add_stat(fns = everything() ~ add_by_n) %>%
modify_header(starts_with("add_n_stat") ~ "**N**") %>%
modify_table_body(~ .x %>%
dplyr::relocate(add_n_stat_1, .before = stat_1) %>%
dplyr::relocate(add_n_stat_2, .before = stat_2)) %>% italicize_labels()
df_1=tb_1$table_body[,c("var_label","stat_0","stat_2")]
df_2=tb_2$table_body[,c("stat_2")]
df_3=tb_3$table_body[,c("stat_2")]
df_4=tb_4$table_body[,c("stat_2")]
df_5=tb_5$table_body[,c("stat_2")]
df_fc = cbind(df_1,
df_2,
df_3,
df_4,
df_5)
names(df_fc)=c("Inspection frequency",
"All",
"Nutrition, health, and food, security",
"Poverty reduction, livelihoods, and jobs",
"Gender equality, youth, and social inclusion",
"Climate adaptation and mitigation",
"Environmental health and biodiversity"
)
# hs <- createStyle(
#   textDecoration = "BOLD", fontColour = "#FFFFFF", fontSize = 12,
#   fontName = "Arial Narrow", fgFill = "#4F80BD"
# )
#
# write.xlsx(df_fc,
#            file = "Tables Ability to evaluate.xlsx",
#            colNames = TRUE, borders = "rows", headerStyle = hs, sheetName = "Ability to evaluate", append=TRUE
# )
# Create flextable object
ft <- flextable(data = df_fc)
# See flextable in RStudio viewer
#ft <- add_header_row(ft)
ft <- theme_vanilla(ft)
ft <- add_footer_lines(ft, "Daily air quality measurements in New York, May to September 1973.")
ft <- color(ft, part = "footer", color = "#666666")
ft <- set_caption(ft, caption = "New York Air Quality Measurements")
ft
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(officedown)
library(officer)
library(gtsummary)
library(flextable)
library(magrittr)
# fp <- fp_par(
#   text.align = "center",
#   padding.bottom = 20, padding.top = 120,
#   border.bottom = fp_border())
#
# ft <- fp_text(shading.color='#EFEFEF', bold = F)
#set_gtsummary_theme(theme_gtsummary_compact())
######### Create default BioAVR table from dataframe
#
# Dependencies : dplyr, flextable, officer
#
customtab_defaults <- function(){
set_flextable_defaults(font.family = "Calibri",
font.size = 10,
border.color = "black")
}
custom_tab <- function(df, header, footer){
flextable(df) %>%
add_header_lines(header) %>%
add_footer_lines(footer) %>%
bold(i = 1, part = "header") %>%
hline_top(part = "header",
border = fp_border(color = "red",
width = 3,
style = "solid")) %>%
hline(i = 1,
part = "header",
border = fp_border(color = "black",
width = 0.25,
style = "solid")) %>%
hline_top(part = "body",
border = fp_border(color = "black",
width = 0.25,
style = "solid")) %>%
hline_bottom(part = "body",
border = fp_border(color = "black",
width = 0.25,
style = "solid")) %>%
hline_bottom(part = "footer",
border = fp_border(color = "black",
width = 0.25,
style = "solid")) %>%
border_inner_h(part = "body",
border = fp_border(color = "black",
width = 0.25,
style = "dotted")) %>%
autofit(part = "body") %>%
bg(part = "body", bg = "#f5f5f5") %>%
align(part = "all", align = "center") %>%
align(j = 1, part = "all", align = "left")
}
var_vec = c("q_iii_24_1",
"q_iii_24_2",
"q_iii_24_3",
"q_iii_24_4",
"q_iii_24_5",
"q_iii_24_96"
)
label_vec = c("Annual",
"Half-yearly",
"Quarterly",
"Bimonthly",
"Monthly",
"Other ( specify)"
)
description = tibble(
name = var_vec,
label = label_vec
)
var_labels <- setNames(as.list(description$label), description$name)
df = EVALUATION_DES_CAPACITES_Hema  %>% dplyr::select(domain,var_vec) %>%
dplyr::mutate(dom_1=ifelse(dom_1==1,"Yes","No")) %>%
dplyr::mutate(dom_2=ifelse(dom_2==1,"Yes","No")) %>%
dplyr::mutate(dom_3=ifelse(dom_3==1,"Yes","No")) %>%
dplyr::mutate(dom_4=ifelse(dom_4==1,"Yes","No")) %>%
dplyr::mutate(dom_5=ifelse(dom_5==1,"Yes","No")) %>%
dplyr::mutate(across(var_vec, as.numeric))
df <- df %>%
set_variable_labels(.labels = var_labels, .strict = FALSE)
View(df)
library(dplyr)
library(expss)
library(openxlsx)
library(readxl)
library(tidyverse)
library(janitor)
library(data.table)
library(stringr)
library(compareDF)
library(sjlabelled)
library(lmtest)
library(sandwich)
library(labelled)
var_vec = c("q_iii_24_1",
"q_iii_24_2",
"q_iii_24_3",
"q_iii_24_4",
"q_iii_24_5",
"q_iii_24_96"
)
label_vec = c("Annual",
"Half-yearly",
"Quarterly",
"Bimonthly",
"Monthly",
"Other ( specify)"
)
description = tibble(
name = var_vec,
label = label_vec
)
var_labels <- setNames(as.list(description$label), description$name)
df = EVALUATION_DES_CAPACITES_Hema  %>% dplyr::select(domain,var_vec) %>%
dplyr::mutate(dom_1=ifelse(dom_1==1,"Yes","No")) %>%
dplyr::mutate(dom_2=ifelse(dom_2==1,"Yes","No")) %>%
dplyr::mutate(dom_3=ifelse(dom_3==1,"Yes","No")) %>%
dplyr::mutate(dom_4=ifelse(dom_4==1,"Yes","No")) %>%
dplyr::mutate(dom_5=ifelse(dom_5==1,"Yes","No")) %>%
dplyr::mutate(across(var_vec, as.numeric))
df <- df %>%
set_variable_labels(.labels = var_labels, .strict = FALSE)
var_label(df)
View(df)
